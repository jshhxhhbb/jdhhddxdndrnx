name: Android Emulator (Zero Setup - Mobile Optimized)

on:
  workflow_dispatch:

jobs:
  emulator:
    runs-on: ubuntu-latest
    timeout-minutes: 360  # æœ€å¤§6æ™‚é–“ï¼ˆç„¡æ–™æ ä¸Šé™ï¼‰

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      # KVMæœ‰åŠ¹åŒ–ï¼ˆé«˜é€ŸåŒ–å¿…é ˆï¼‰
      - name: Enable KVM
        run: |
          echo 'KERNEL=="kvm", GROUP="kvm", MODE="0666"' | sudo tee /etc/udev/rules.d/99-kvm.rules
          sudo udevadm control --reload-rules && sudo udevadm trigger

      # æœ€é€ŸAndroid 14 Emulatorèµ·å‹•ï¼ˆ2025å¹´ç¾åœ¨æœ€å¼·ï¼‰
      - name: Start Android 14 Emulator (Samsung Galaxy S10 + Ultra Fast noVNC)
        run: |
          docker run -d \
            --name android-emulator \
            --device /dev/kvm \
            -p 6080:6080 \
            -p 5555:5555 \
            -e EMULATOR_DEVICE="Samsung Galaxy S10" \
            -e WEB_VNC=true \
            budtmo/docker-android:emulator_14.0

          echo "ğŸš€ ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿èµ·å‹•ä¸­...ï¼ˆåˆå›ã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§1ã€œ2åˆ†ã€èµ·å‹•ã¾ã§ç´„90ç§’ï¼‰"
          sleep 120  # å®‰å…¨ãƒãƒ¼ã‚¸ãƒ³

      # ãƒãƒ¼ãƒˆ6080å…¬é–‹ â†’ ãƒ­ã‚°ã®ãƒªãƒ³ã‚¯ã‚’ã‚¹ãƒãƒ›ã§ã‚¿ãƒƒãƒ—ï¼
      - name: ğŸ‰ Expose noVNC (ã‚¹ãƒãƒ›ã§å³æ¥ç¶šï¼)
        run: |
          echo ""
          echo "===================================================================="
          echo "   ğŸ¯ ã‚¹ãƒãƒ›ã§ã“ã®ãƒªãƒ³ã‚¯ã‚’ã‚¿ãƒƒãƒ— â†’ å³Android 14ï¼ˆSamsung Galaxy S10ï¼‰ãŒèµ·å‹•ï¼"
          echo "   ã‚¿ãƒƒãƒæ“ä½œå®Œç’§ãƒ»ãƒ¢ãƒã‚¤ãƒ«æœ€é©åŒ–æ¸ˆã¿ï¼ˆãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³æ¨å¥¨ï¼‰"
          echo "===================================================================="
          echo "   ä¸‹è¨˜ã® Forwarding ãƒªãƒ³ã‚¯ã‚’ã‚¿ãƒƒãƒ—ï¼ˆè‡ªå‹•è¡¨ç¤ºã•ã‚Œã¾ã™ï¼‰"
          echo ""
          echo "   â¡ï¸ https://xxxxxxx.github.dev/?port=6080"
          echo ""
          echo "   ï¼ˆãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãªã—ãƒ»ãƒ”ãƒ³ãƒã‚ºãƒ¼ãƒ å¯¾å¿œï¼‰"
          echo "===================================================================="
          sleep 999999  # ã»ã¼ç„¡é™ã‚­ãƒ¼ãƒ—

      # æœ€å¤§6æ™‚é–“ã‚­ãƒ¼ãƒ—
      - name: Keep alive (max 6 hours)
        if: always()
        run: sleep 21600
