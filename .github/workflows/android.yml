name: Android Emulator (Zero Setup - Mobile Optimized)

on:
  workflow_dispatch:

jobs:
  emulator:
    runs-on: ubuntu-latest
    timeout-minutes: 360  # æœ€å¤§6æ™‚é–“

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      # KVMæœ‰åŠ¹åŒ–ï¼ˆå¿…é ˆãƒ»é«˜é€ŸåŒ–ï¼‰
      - name: Enable KVM
        run: |
          echo 'KERNEL=="kvm", GROUP="kvm", MODE="0666"' | sudo tee /etc/udev/rules.d/99-kvm.rules
          sudo udevadm control --reload-rules && sudo udevadm trigger

      # æœ€é€ŸAndroid 14 Emulatorèµ·å‹•ï¼ˆ2025å¹´ç¾åœ¨ã“ã‚ŒãŒæœ€å¼·ï¼‰
      - name: Start Android 14 Emulator (Pixel 6 + Ultra Fast noVNC)
        run: |
          docker run -d \
            --name android-emulator \
            --device /dev/kvm \
            -p 6080:6080 \
            -p 5555:5555 \
            -e DEVICE="pixel_6" \
            -e WEB_VNC=true \
            -e RAM_SIZE=4096 \
            -e NO_VNC_RESOLUTION=1080x2340 \
            budtmo/docker-android:emulator_14.0

          echo "ğŸš€ ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿èµ·å‹•ä¸­...ï¼ˆåˆå›ã¯ã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§1ã€œ2åˆ†ã€èµ·å‹•å®Œäº†ã¾ã§ç´„90ç§’ï¼‰"
          sleep 120  # å®‰å…¨ãƒãƒ¼ã‚¸ãƒ³ï¼ˆå¿…è¦ã«å¿œã˜ã¦èª¿æ•´å¯ï¼‰

      # ãƒãƒ¼ãƒˆ6080ã‚’å…¬é–‹ â†’ ãƒ­ã‚°ã«è¡¨ç¤ºã•ã‚Œã‚‹ãƒªãƒ³ã‚¯ã‚’ã‚¹ãƒãƒ›ã§ã‚¿ãƒƒãƒ—ã™ã‚‹ã ã‘ï¼
      - name: ğŸ‰ Expose noVNC (ã‚¹ãƒãƒ›ã§å³æ¥ç¶šå¯èƒ½ï¼)
        run: |
          echo ""
          echo "===================================================================="
          echo "   ğŸ¯ ã‚¹ãƒãƒ›ã§ã“ã®ãƒªãƒ³ã‚¯ã‚’ã‚¿ãƒƒãƒ— â†’ å³Android 14ï¼ˆPixel 6ï¼‰ãŒèµ·å‹•ï¼"
          echo "   è¶…ã‚µã‚¯ã‚µã‚¯ãƒ»ã‚¿ãƒƒãƒæ“ä½œå®Œç’§ãƒ»ç¸¦æŒã¡æœ€é©åŒ–æ¸ˆã¿ã§ã™ï¼ï¼"
          echo "===================================================================="
          echo "   ä¸‹è¨˜ã® Forwarding ãƒªãƒ³ã‚¯ã‚’ã‚¿ãƒƒãƒ—ï¼ˆè‡ªå‹•ã§è¡¨ç¤ºã•ã‚Œã¾ã™ï¼‰"
          echo ""
          echo "   â¡ï¸ https://xxxxxxx.github.dev/?port=6080"
          echo ""
          echo "   ï¼ˆãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãªã—ãƒ»ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³æ¨å¥¨ãƒ»ãƒ”ãƒ³ãƒã‚ºãƒ¼ãƒ ã‚‚åŠ¹ãã¾ã™ï¼‰"
          echo "===================================================================="
          sleep 999999  # ã»ã¼ç„¡é™ã‚­ãƒ¼ãƒ—

      # æœ€å¤§6æ™‚é–“ã‚­ãƒ¼ãƒ—ï¼ˆGitHub Actionsç„¡æ–™æ ã®ä¸Šé™ï¼‰
      - name: Keep alive (max 6 hours)
        if: always()
        run: sleep 21600
